<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8" />
    <title>French Vocabulary Trainer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="styles.css" />
</head>

<body>

    <header>
        <strong>üá´üá∑ French Trainer</strong>
        <nav>
            <a href="vocab.html" class="active">Eingabe</a>
            <a href="vocab_show.html">Vokabeln</a>
        </nav>
    </header>

    <div class="container">
        <div class="card">
            <h1>French Vocabulary Trainer</h1>

            <table>
                <thead>
                    <tr>
                        <th>Fran√ßais</th>
                        <th>Anglais</th>
                        <th>Phrase</th>
                    </tr>
                </thead>
                <tbody id="rows"></tbody>
            </table>

            <button id="submitBtn" onclick="submitData()">Absenden & Text generieren</button>
            <div class="error" id="error"></div>
            <div class="result" id="result" style="display:none;"></div>
        </div>
    </div>

    <script>
        const ROW_COUNT = 15;
        const WEBHOOK_SUBMIT_URL = "https://n8n.srv1220381.hstgr.cloud/webhook-test/4575a119-a0ee-4bf6-9cea-627aa5217998";

        const tbody = document.getElementById("rows");
        const resultBox = document.getElementById("result");
        const errorBox = document.getElementById("error");
        const submitBtn = document.getElementById("submitBtn");

        for (let i = 0; i < ROW_COUNT; i++) {
            tbody.insertAdjacentHTML("beforeend", `
            <tr>
                <td><input placeholder="fran√ßais" /></td>
                <td><input placeholder="english" /></td>
                <td><input placeholder="phrase (optional)" /></td>
            </tr>
        `);
        }

        async function submitData() {
            errorBox.textContent = "";
            resultBox.style.display = "none";
            submitBtn.disabled = true;
            submitBtn.textContent = "Sende‚Ä¶";

            const rows = [...tbody.querySelectorAll("tr")]
                .map(tr => {
                    const inputs = tr.querySelectorAll("input");
                    return {
                        francais: inputs[0].value.trim(),
                        anglais: inputs[1].value.trim(),
                        phrase: inputs[2].value.trim()
                    };
                })
                .filter(r => r.francais || r.anglais || r.phrase);

            if (rows.length === 0) {
                errorBox.textContent = "Bitte mindestens eine Zeile ausf√ºllen.";
                submitBtn.disabled = false;
                submitBtn.textContent = "Absenden & Text generieren";
                return;
            }

            try {
                const response = await fetch(WEBHOOK_SUBMIT_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ rows })
                });

                if (!response.ok) throw new Error("Webhook antwortet nicht korrekt");

                const data = await response.json();
                resultBox.style.display = "block";
                resultBox.textContent = data.generatedText || "‚ö†Ô∏è Kein Text zur√ºckgegeben.";

            } catch (err) {
                console.error(err);
                errorBox.textContent = "Fehler beim Senden der Daten. Siehe Konsole.";
            }

            submitBtn.disabled = false;
            submitBtn.textContent = "Absenden & Text generieren";
        }
    </script>

</body>

</html>